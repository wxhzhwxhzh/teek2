import{_ as i,c as a,o as n,aN as h}from"./chunks/framework.0ZSa6Wd7.js";const o=JSON.parse('{"title":"ğŸ”µ  page.route()","description":"","frontmatter":{"id":"intro4","permalink":"/pw/intro4","title":"ğŸ”µ  page.route()"},"headers":[],"relativePath":"pw/7.route.md","filePath":"pw/7.route.md"}'),l={name:"pw/7.route.md"};function t(e,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[h(`<h1 id="ğŸ”µ-page-route" tabindex="-1">ğŸ”µ page.route() <a class="header-anchor" href="#ğŸ”µ-page-route" aria-label="Permalink to &quot;ğŸ”µ  page.route()&quot;">â€‹</a></h1><p><strong>Playwrightï¼ˆPythonï¼‰é‡Œ <code>page.route</code></strong> çš„æ¦‚å¿µã€APIã€å¸¸è§ç”¨æ³•ã€æ³¨æ„äº‹é¡¹å’Œå¯å¤ç”¨çš„åŒæ­¥/å¼‚æ­¥ç¤ºä¾‹</p><h1 id="æ¦‚è§ˆ-ä¸€å¥è¯" tabindex="-1">æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰ <a class="header-anchor" href="#æ¦‚è§ˆ-ä¸€å¥è¯" aria-label="Permalink to &quot;æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰&quot;">â€‹</a></h1><p><code>page.route(pattern, handler)</code> ç”¨æ¥æ‹¦æˆªé¡µé¢å‘å‡ºçš„ç½‘ç»œè¯·æ±‚ï¼ˆXHRã€fetchã€å›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰ï¼ŒæŠŠè¯·æ±‚äº¤ç»™ä½ å†™çš„ <code>handler(route, request)</code> æ¥å†³å®šï¼š<strong>ç»§ç»­å‘é€ / ä¿®æ”¹åå‘é€ / ç›´æ¥è¿”å›å‡æ•°æ® / ä¸­æ­¢è¯·æ±‚</strong>ã€‚ä¸€æ—¦å¯ç”¨åŒ¹é…çš„è·¯ç”±ï¼Œè¯·æ±‚ä¼šè¢«â€œæŒ‚èµ·â€ï¼Œç›´åˆ°ä½ ç”¨ <code>route.continue_()</code> / <code>route.fulfill()</code> / <code>route.abort()</code> / <code>route.fallback()</code> ä¹‹ä¸€å¤„ç†å®ƒã€‚ ([playwright.dev][1])</p><hr><h1 id="åŸºæœ¬æ¦‚å¿µä¸ç­¾å" tabindex="-1">åŸºæœ¬æ¦‚å¿µä¸ç­¾å <a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µä¸ç­¾å" aria-label="Permalink to &quot;åŸºæœ¬æ¦‚å¿µä¸ç­¾å&quot;">â€‹</a></h1><ul><li>æ³¨å†Œè·¯ç”±ï¼ˆåŒæ­¥ APIï¼‰ï¼š</li></ul><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/api/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># handler(route, request)</span></span></code></pre></div><ul><li>æ³¨å†Œè·¯ç”±ï¼ˆå¼‚æ­¥ APIï¼‰é€šå¸¸å†™æ³•ï¼ˆä¹Ÿå¯ç›´æ¥ä¸ awaitï¼Œå®˜æ–¹ç¤ºä¾‹æœ‰ await çš„å†™æ³•ï¼‰ï¼š</li></ul><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/api/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># async def handler(route, request)</span></span></code></pre></div><ul><li>handler çš„ä¸¤ä¸ªå‚æ•°ï¼š<code>route</code>ï¼ˆRoute å¯¹è±¡ï¼Œç”¨æ¥æ“ä½œè¯·æ±‚ï¼‰å’Œ <code>request</code>ï¼ˆRequest å¯¹è±¡ï¼Œç”¨æ¥è¯»å–åŸå§‹è¯·æ±‚ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>request.url</code>, <code>request.method</code>, <code>request.post_data</code> ç­‰ï¼‰ã€‚ ([playwright.dev][1])</li></ul><hr><h1 id="route-å¸¸ç”¨æ–¹æ³•-é€ŸæŸ¥" tabindex="-1">Route å¸¸ç”¨æ–¹æ³•ï¼ˆé€ŸæŸ¥ï¼‰ <a class="header-anchor" href="#route-å¸¸ç”¨æ–¹æ³•-é€ŸæŸ¥" aria-label="Permalink to &quot;Route å¸¸ç”¨æ–¹æ³•ï¼ˆé€ŸæŸ¥ï¼‰&quot;">â€‹</a></h1><ul><li><code>route.continue_(**overrides)</code>ï¼šæŠŠè¯·æ±‚å‘åˆ°ç½‘ç»œï¼Œå¯ä»¥ç”¨ <code>headers</code>, <code>method</code>, <code>post_data</code>, <code>url</code> ç­‰è¦†ç›–ï¼ˆæ³¨æ„ <code>continue_</code> åœ¨ Python ä¸­æ˜¯ <code>continue_</code>ï¼Œå› ä¸º <code>continue</code> æ˜¯å…³é”®å­—ï¼‰ã€‚<strong>ä½¿ç”¨ <code>continue_</code> æ—¶ï¼Œå…¶ä»–å·²æ³¨å†Œçš„åŒ¹é…å¤„ç†å™¨ä¸ä¼šå†è¢«è°ƒç”¨</strong>ï¼ˆç«‹å³å‘é€ï¼‰ã€‚ ([playwright.dev][2])</li><li><code>route.fallback(**overrides)</code>ï¼šä¸ <code>continue_</code> ç±»ä¼¼ï¼Œä½†ä¼šæŠŠè¯·æ±‚â€œä¼ é€’åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…çš„ handlerâ€ï¼Œå³å…è®¸é“¾å¼/å±‚å çš„å¤„ç†å™¨åä½œï¼ˆintroduced v1.23ï¼‰ã€‚ ([playwright.dev][2])</li><li><code>route.fulfill(status=..., body=..., content_type=..., headers=..., path=..., response=..., json=...)</code>ï¼šç›´æ¥ç”¨ä½ æŒ‡å®šçš„å“åº”æ¥â€œå®Œæˆâ€è¯·æ±‚ï¼ˆmock å“åº”ï¼‰ã€‚å¯ä»¥ç›´æ¥ä»¥ <code>body</code>/<code>path</code>/æˆ– <code>response</code>ï¼ˆæ¥è‡ª <code>route.fetch()</code>ï¼‰ä½œä¸ºåŸºç¡€å¹¶åšä¿®æ”¹ã€‚ ([playwright.dev][3])</li><li><code>route.abort(error_code=None)</code>ï¼šä¸­æ­¢è¯·æ±‚ï¼ˆé»˜è®¤ <code>failed</code>ï¼Œä¹Ÿå¯ä»¥ä¼ ç‰¹å®šé”™è¯¯ç ï¼‰ã€‚ ([playwright.dev][2])</li><li><code>route.fetch()</code>ï¼šä»ç½‘ç»œæ‰§è¡ŒåŸå§‹è¯·æ±‚å¹¶è¿”å› <code>Response</code> å¯¹è±¡ï¼ˆä¾¿äºåŸºäºçœŸå®å“åº”åšä¿®æ”¹åå† <code>fulfill</code>ï¼‰ã€‚ ([playwright.dev][4])</li></ul><hr><h1 id="åŒ¹é…è§„åˆ™ã€ä¼˜å…ˆçº§ä¸å–æ¶ˆè·¯ç”±" tabindex="-1">åŒ¹é…è§„åˆ™ã€ä¼˜å…ˆçº§ä¸å–æ¶ˆè·¯ç”± <a class="header-anchor" href="#åŒ¹é…è§„åˆ™ã€ä¼˜å…ˆçº§ä¸å–æ¶ˆè·¯ç”±" aria-label="Permalink to &quot;åŒ¹é…è§„åˆ™ã€ä¼˜å…ˆçº§ä¸å–æ¶ˆè·¯ç”±&quot;">â€‹</a></h1><ul><li><code>url</code> å‚æ•°å¯ä»¥æ˜¯ globï¼ˆ<code>**/*</code>ï¼‰ã€æ­£åˆ™æˆ–å›è°ƒ predicateï¼ˆæ¥æ”¶ URL åˆ¤æ–­ï¼‰ï¼Œéå¸¸çµæ´»ã€‚ ([playwright.dev][5])</li><li><strong>ä¼˜å…ˆçº§</strong>ï¼š<code>page.route</code>ï¼ˆåªå¯¹è¯¥ pageï¼‰æ¯” <code>browser_context.route</code> æ›´é«˜ï¼ˆå³åŒä¸€è¯·æ±‚åŒæ—¶åŒ¹é… page å’Œ context çš„è§„åˆ™æ—¶ï¼Œpage çš„ handler ä¼˜å…ˆï¼‰ã€‚è¦å¯¹æ‰€æœ‰é¡µé¢ï¼ˆåŒ…æ‹¬ popupï¼‰æ‹¦æˆªï¼Œè€ƒè™‘ç”¨ <code>context.route</code>ã€‚ ([playwright.dev][5])</li><li>å–æ¶ˆè·¯ç”±ï¼š<code>page.unroute(url[, handler])</code> â€”â€” å¦‚æœä¸ä¼  handlerï¼Œä¼šç§»é™¤åŒ¹é… URL çš„æ‰€æœ‰è·¯ç”±ã€‚ ([playwright.dev][1])</li></ul><hr><h1 id="å®æˆ˜ç¤ºä¾‹-å¯ç›´æ¥å¤åˆ¶ç²˜è´´æ”¹é€ " tabindex="-1">å®æˆ˜ç¤ºä¾‹ï¼ˆå¯ç›´æ¥å¤åˆ¶ç²˜è´´æ”¹é€ ï¼‰ <a class="header-anchor" href="#å®æˆ˜ç¤ºä¾‹-å¯ç›´æ¥å¤åˆ¶ç²˜è´´æ”¹é€ " aria-label="Permalink to &quot;å®æˆ˜ç¤ºä¾‹ï¼ˆå¯ç›´æ¥å¤åˆ¶ç²˜è´´æ”¹é€ ï¼‰&quot;">â€‹</a></h1><h2 id="_1-åŒæ­¥-api-æ‹¦æˆªå¹¶-mock-æŸä¸ª-api" tabindex="-1">1) åŒæ­¥ APIï¼šæ‹¦æˆªå¹¶ mock æŸä¸ª API <a class="header-anchor" href="#_1-åŒæ­¥-api-æ‹¦æˆªå¹¶-mock-æŸä¸ª-api" aria-label="Permalink to &quot;1) åŒæ­¥ APIï¼šæ‹¦æˆªå¹¶ mock æŸä¸ª API&quot;">â€‹</a></h2><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> playwright.sync_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw.chromium.launch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> browser.new_page()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route, request):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;api.example.com/data&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.url:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                body </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json.dumps({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mocked&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                route.fulfill(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                route.continue_()   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸€å®šè¦å¤„ç†ï¼Œå¦åˆ™è¯·æ±‚ä¼šæŒ‚èµ·</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/api/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.goto(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser.close()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    run()</span></span></code></pre></div><h2 id="_2-å¼‚æ­¥-api-åŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›-fetch-â†’-æ”¹-json-â†’-fulfill" tabindex="-1">2) å¼‚æ­¥ APIï¼šåŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›ï¼ˆfetch â†’ æ”¹ json â†’ fulfillï¼‰ <a class="header-anchor" href="#_2-å¼‚æ­¥-api-åŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›-fetch-â†’-æ”¹-json-â†’-fulfill" aria-label="Permalink to &quot;2) å¼‚æ­¥ APIï¼šåŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›ï¼ˆfetch â†’ æ”¹ json â†’ fulfillï¼‰&quot;">â€‹</a></h2><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> playwright.async_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> async_playwright</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> async_playwright() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw.chromium.launch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> browser.new_context()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.new_page()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route, request):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/xhr_endpoint&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.url:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # è¯·æ±‚åŸå§‹æ•°æ®ï¼Œç„¶ååœ¨è¿”å›å†…å®¹ä¸Šæ‰“è¡¥ä¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.fetch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;injected_by_test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.fulfill(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.continue_()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/xhr_endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.goto(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> browser.close()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asyncio.run(run())</span></span></code></pre></div><h2 id="_3-åŒæ­¥-api-åŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›-fetch-â†’-æ”¹-json-â†’-fulfill" tabindex="-1">3) åŒæ­¥ APIï¼šåŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›ï¼ˆfetch â†’ æ”¹ json â†’ fulfillï¼‰ <a class="header-anchor" href="#_3-åŒæ­¥-api-åŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›-fetch-â†’-æ”¹-json-â†’-fulfill" aria-label="Permalink to &quot;3) åŒæ­¥ APIï¼šåŸºäºçœŸå®å“åº”ä¿®æ”¹å¹¶è¿”å›ï¼ˆfetch â†’ æ”¹ json â†’ fulfillï¼‰&quot;">â€‹</a></h2><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> playwright.sync_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pw.chromium.launch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> browser.new_page()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route, request):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/xhr_endpoint&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.url:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.fetch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.json()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                data[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;patched_by_test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                route.fulfill(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                route.continue_()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/xhr_endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.goto(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser.close()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    run()</span></span></code></pre></div><p>ï¼ˆä¸Šé¢ <code>route.fetch()</code> + <code>route.fulfill(response=..., json=...)</code> æ˜¯å®˜æ–¹æ¨èç”¨æ³•ï¼Œç”¨äºâ€œåœ¨çœŸå®å“åº”åŸºç¡€ä¸Šåšå°æ”¹åŠ¨å†è¿”å›â€ã€‚ï¼‰ ([playwright.dev][4])</p><hr><h1 id="å¸¸è§åœºæ™¯ä¸å°æŠ€å·§" tabindex="-1">å¸¸è§åœºæ™¯ä¸å°æŠ€å·§ <a class="header-anchor" href="#å¸¸è§åœºæ™¯ä¸å°æŠ€å·§" aria-label="Permalink to &quot;å¸¸è§åœºæ™¯ä¸å°æŠ€å·§&quot;">â€‹</a></h1><ul><li><strong>åªæ‹¦æˆªä½ å…³å¿ƒçš„ URL åŒºé—´</strong>ï¼ˆæ¯”å¦‚ <code>**/api/**</code>ï¼‰ï¼Œé¿å…ç”¨ <code>**/*</code> å…¨æ‹¦æˆªï¼Œæ€§èƒ½å’Œè°ƒè¯•éƒ½ä¼šæ›´å‹å¥½ã€‚</li><li><strong>æ¨¡æ‹Ÿæ…¢ç½‘é€Ÿ / è¶…æ—¶</strong>ï¼šå¯ä»¥ <code>time.sleep</code>ï¼ˆåŒæ­¥ï¼‰æˆ– <code>await asyncio.sleep</code>ï¼ˆå¼‚æ­¥ï¼‰å <code>fulfill()</code> æ¥æ¨¡æ‹Ÿå»¶è¿Ÿï¼Œæˆ– <code>abort(&quot;timedout&quot;)</code>ã€‚</li><li><strong>ä¿®æ”¹è¯·æ±‚å¤´ / body</strong>ï¼šåœ¨ <code>route.continue_(headers=..., method=..., post_data=..., url=...)</code> é‡Œè¦†ç›–ã€‚æ³¨æ„ï¼šheaders ä¼šä½œç”¨åˆ°é‡å®šå‘çš„è¯·æ±‚ï¼Œä½† <code>url/method/post_data</code> çš„è¦†ç›–åªåº”ç”¨åˆ°åŸå§‹è¯·æ±‚ï¼Œä¸ä¼šè‡ªåŠ¨ä¼ é€’åˆ°é‡å®šå‘åçš„è¯·æ±‚ã€‚ ([playwright.dev][3])</li><li><strong>å±‚å è·¯ç”±ï¼ˆfallbackï¼‰</strong>ï¼šç”¨ <code>route.fallback()</code> å¯ä»¥è®©å¤šä¸ª handler ä¸²è”ï¼Œæœ€åä¸€ä¸ª handler å†³å®šæœ€ç»ˆè¡Œä¸ºï¼›è€Œ <code>continue_()</code> åˆ™ä¼šç«‹å³æŠŠè¯·æ±‚å‘å‡ºå¹¶è·³è¿‡åç»­ handlerã€‚ ([playwright.dev][2])</li><li><strong>ä¸è¦å¿˜äº†æ‰€æœ‰åˆ†æ”¯éƒ½å¤„ç†</strong>ï¼šå¦‚æœ handler åœ¨æŸäº›åˆ†æ”¯æ—¢æ²¡ <code>continue_()</code>ã€ä¹Ÿæ²¡ <code>fulfill()</code> / <code>abort()</code>ï¼Œå¯¹åº”è¯·æ±‚ä¼šä¸€ç›´æŒ‚èµ·ï¼Œå¯¼è‡´é¡µé¢æ“ä½œå¡ä½ï¼ˆéå¸¸å¸¸è§çš„é™·é˜±ï¼‰ã€‚ ([playwright.dev][1])</li></ul><hr><h1 id="æ³¨æ„äº‹é¡¹-å¸¸è§å‘" tabindex="-1">æ³¨æ„äº‹é¡¹ / å¸¸è§å‘ <a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-å¸¸è§å‘" aria-label="Permalink to &quot;æ³¨æ„äº‹é¡¹ / å¸¸è§å‘&quot;">â€‹</a></h1><ul><li><strong>å¯ç”¨è·¯ç”±ä¼šç¦ç”¨ HTTP ç¼“å­˜</strong>ï¼ˆæ–‡æ¡£æœ‰æ˜ç¡®è¯´æ˜ï¼‰ï¼Œæµ‹è¯•æ—¶å¯èƒ½å› æ­¤çœ‹åˆ°ä¸åŒçš„è¡Œä¸ºã€‚ ([playwright.dev][5])</li><li><code>continue_()</code> ä¸èƒ½è¦†ç›– <code>Cookie</code> headerï¼ˆæµè§ˆå™¨ä¼šä» cookie store åŠ è½½ï¼‰ï¼Œå¦‚æœä½ éœ€è¦è‡ªå®šä¹‰ cookieï¼Œè¯·ç”¨ <code>context.add_cookies()</code> æˆ–å…¶ä»–åŠæ³•ã€‚ ï¼ˆæ–‡æ¡£å’Œå®ç°é‡Œæåˆ° Cookie è¦†ç›–æ˜¯å—é™çš„ï¼‰ ([playwright-ruby-client.vercel.app][6])</li><li>å½“å¤šä¸ª route pattern åŒ¹é…æ—¶ï¼Œæ‰§è¡Œé¡ºåº<strong>æ˜¯æ³¨å†Œé¡ºåºçš„åå‘</strong>ï¼ˆæœ€åæ³¨å†Œçš„å…ˆæ‰§è¡Œï¼‰ï¼Œè¿™è®©â€œè¦†ç›–é»˜è®¤è·¯ç”±â€çš„æ¨¡å¼å¾ˆæ–¹ä¾¿ï¼Œä½†ä¹Ÿè¦ç•™æ„é¡ºåºã€‚ ([Cuketest][7])</li></ul><hr><h1 id="å°å‹-cheatsheet-è°ƒç”¨æ ¼å¼" tabindex="-1">å°å‹ cheatsheetï¼ˆè°ƒç”¨æ ¼å¼ï¼‰ <a class="header-anchor" href="#å°å‹-cheatsheet-è°ƒç”¨æ ¼å¼" aria-label="Permalink to &quot;å°å‹ cheatsheetï¼ˆè°ƒç”¨æ ¼å¼ï¼‰&quot;">â€‹</a></h1><ul><li>æ³¨å†Œï¼š<code>page.route(url, handler)</code> æˆ– <code>context.route(url, handler)</code>ã€‚ ([playwright.dev][1])</li><li>å¤„ç†ï¼š<code>route.continue_(headers=..., url=..., method=..., post_data=...)</code>ã€‚ ([playwright.dev][3])</li><li>mockï¼š<code>route.fulfill(status=200, content_type=&#39;application/json&#39;, body=json.dumps(...))</code> æˆ– <code>route.fulfill(response=response, json=...)</code>ã€‚ ([playwright.dev][3])</li><li>ä¸­æ­¢ï¼š<code>route.abort()</code>ã€‚ ([playwright.dev][2])</li><li>åŸå§‹è¯·æ±‚ï¼š<code>response = await route.fetch()</code>ã€‚ ([playwright.dev][4])</li><li>å–æ¶ˆè·¯ç”±ï¼š<code>page.unroute(url[, handler])</code>ã€‚ ([playwright.dev][1])</li></ul><hr><h2 id="_4-å®æˆ˜ä»£ç ç¤ºä¾‹1" tabindex="-1">4.å®æˆ˜ä»£ç ç¤ºä¾‹1 <a class="header-anchor" href="#_4-å®æˆ˜ä»£ç ç¤ºä¾‹1" aria-label="Permalink to &quot;4.å®æˆ˜ä»£ç ç¤ºä¾‹1&quot;">â€‹</a></h2><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> playwright.sync_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright,Request,Response,Route</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å­˜å‚¨æ‰€æœ‰JSONå“åº”çš„åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">json_responses </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route:Route, request:Request):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.resource_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ‹¦æˆªå›¾ç‰‡è¯·æ±‚ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        route.continue_(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://wxhzhwxhzh.github.io/sao/fav2.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        route.continue_()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_route2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æŠ“å–åå°jsonæ•°æ®åŒ…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.fetch()    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ£€æŸ¥å“åº”æ˜¯å¦ä¸ºJSONç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.headers.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/json&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_type:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # è§£æJSONæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            json_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.json()          </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # æ‰“å°æ•è·åˆ°çš„JSONä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">æ•è·åˆ°JSONå“åº”: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> (çŠ¶æ€ç : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JSONæ•°æ®:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(json_data)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;è§£æJSONå¤±è´¥ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç»§ç»­åŸå§‹å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    route.continue_()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handle_route3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(route:Route, request:Request):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ‹¦æˆªå¹¶ç¯¡æ”¹ç½‘é¡µåŸç”Ÿjsçš„å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;head.js&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.url:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response:Response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> route.fetch()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        old_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;window.Douban = &quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        new_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;console.log(&#39;éªšç¥çœŸå¸…ï¼ï¼ï¼ï¼ï¼ï¼&#39;);&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.text().replace(old_str, new_str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">old_str)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body_bytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.encode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        route.fulfill(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.headers, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.status, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        route.continue_()    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sync_playwright() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¯åŠ¨æµè§ˆå™¨ï¼ˆé»˜è®¤ä¸º Chromiumï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ p.firefox æˆ– p.webkitï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.chromium.launch(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headless</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># headless=False è¡¨ç¤ºæ˜¾ç¤ºæµè§ˆå™¨çª—å£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> browser.new_page()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.route(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;**/*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handle_route3)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‹¦æˆªæ‰€æœ‰è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ‰“å¼€è±†ç“£é¦–é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.goto(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://www.douban.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        page.wait_for_timeout(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç­‰å¾…3ç§’ï¼ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ‰“å°é¡µé¢æ ‡é¢˜</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;é¡µé¢æ ‡é¢˜:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, page.title())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å…³é—­æµè§ˆå™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        browser.close()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    main()</span></span></code></pre></div>`,38)])])}const g=i(l,[["render",t]]);export{o as __pageData,g as default};
