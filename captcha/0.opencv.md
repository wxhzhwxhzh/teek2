---
id: intro0
permalink: /captcha/m0
title: 'OpenCV 入门'
---

# OpenCV Python 入门指南

## 目录
1. [OpenCV 简介](#opencv-简介)
2. [安装配置](#安装配置)
3. [图像基础操作](#图像基础操作)
4. [图像处理](#图像处理)
5. [视频处理](#视频处理)
6. [图像特征检测](#图像特征检测)
7. [实战案例](#实战案例)

---

## OpenCV 简介

OpenCV (Open Source Computer Vision Library) 是一个开源的计算机视觉和机器学习软件库。它包含了超过 2500 个优化算法，可用于：

- 图像和视频的读取、显示和保存
- 图像处理（滤波、变换、增强等）
- 目标检测和识别
- 人脸检测和识别
- 特征提取和匹配
- 机器学习应用

---

## 安装配置

### 安装 OpenCV

使用 pip 安装 OpenCV Python 包：

```bash
pip install opencv-python
pip install opencv-contrib-python  # 包含额外的模块
```

### 验证安装

```python
import cv2
print(cv2.__version__)
```

---

## 图像基础操作

### 1. 读取图像

```python
import cv2

# 读取图像
img = cv2.imread('image.jpg')

# 读取灰度图像
gray_img = cv2.imread('image.jpg', cv2.IMREAD_GRAYSCALE)

# 检查图像是否成功加载
if img is None:
    print("无法读取图像")
```

### 2. 显示图像

```python
# 显示图像
cv2.imshow('Image Window', img)
cv2.waitKey(0)  # 等待按键，0 表示无限等待
cv2.destroyAllWindows()  # 关闭所有窗口
```

### 3. 保存图像

```python
# 保存图像
cv2.imwrite('output.jpg', img)
```

### 4. 获取图像属性

```python
# 图像尺寸（高度，宽度，通道数）
print(img.shape)

# 图像数据类型
print(img.dtype)

# 图像大小（像素总数）
print(img.size)
```

### 5. 访问和修改像素

```python
# 访问像素值 (B, G, R)
pixel = img[100, 100]
print(pixel)

# 修改像素值
img[100, 100] = [255, 255, 255]

# 访问单个通道
blue = img[100, 100, 0]
```

### 6. 图像 ROI (Region of Interest)

```python
# 提取感兴趣区域
roi = img[100:200, 100:200]

# 将 ROI 复制到另一个位置
img[300:400, 300:400] = roi
```

### 7. 拆分和合并通道

```python
# 拆分通道
b, g, r = cv2.split(img)

# 合并通道
img = cv2.merge([b, g, r])

# 也可以使用 NumPy 索引
b = img[:, :, 0]
g = img[:, :, 1]
r = img[:, :, 2]
```

---

## 图像处理

### 1. 颜色空间转换

```python
# BGR 转 RGB
rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# BGR 转灰度
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# BGR 转 HSV
hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
```

### 2. 图像缩放

```python
# 指定尺寸缩放
resized = cv2.resize(img, (300, 300))

# 按比例缩放
resized = cv2.resize(img, None, fx=0.5, fy=0.5)

# 使用不同的插值方法
resized = cv2.resize(img, (300, 300), interpolation=cv2.INTER_LINEAR)
```

### 3. 图像旋转

```python
# 获取图像中心
(h, w) = img.shape[:2]
center = (w // 2, h // 2)

# 获取旋转矩阵（旋转 45 度，缩放 1.0）
M = cv2.getRotationMatrix2D(center, 45, 1.0)

# 执行旋转
rotated = cv2.warpAffine(img, M, (w, h))
```

### 4. 图像翻转

```python
# 水平翻转
flipped_h = cv2.flip(img, 1)

# 垂直翻转
flipped_v = cv2.flip(img, 0)

# 水平和垂直翻转
flipped_both = cv2.flip(img, -1)
```

### 5. 图像滤波

```python
# 均值滤波
blur = cv2.blur(img, (5, 5))

# 高斯滤波
gaussian = cv2.GaussianBlur(img, (5, 5), 0)

# 中值滤波（对椒盐噪声效果好）
median = cv2.medianBlur(img, 5)

# 双边滤波（保边去噪）
bilateral = cv2.bilateralFilter(img, 9, 75, 75)
```

### 6. 边缘检测

```python
# Canny 边缘检测
edges = cv2.Canny(gray, 100, 200)

# Sobel 算子
sobelx = cv2.Sobel(gray, cv2.CV_64F, 1, 0, ksize=5)
sobely = cv2.Sobel(gray, cv2.CV_64F, 0, 1, ksize=5)

# Laplacian 算子
laplacian = cv2.Laplacian(gray, cv2.CV_64F)
```

### 7. 图像阈值处理

```python
# 简单阈值
ret, thresh = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY)

# 自适应阈值
adaptive = cv2.adaptiveThreshold(gray, 255, 
                                 cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
                                 cv2.THRESH_BINARY, 11, 2)

# Otsu 阈值
ret, otsu = cv2.threshold(gray, 0, 255, 
                          cv2.THRESH_BINARY + cv2.THRESH_OTSU)
```

### 8. 形态学操作

```python
# 定义结构元素
kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (5, 5))

# 腐蚀
erosion = cv2.erode(img, kernel, iterations=1)

# 膨胀
dilation = cv2.dilate(img, kernel, iterations=1)

# 开运算（先腐蚀后膨胀，去除小噪点）
opening = cv2.morphologyEx(img, cv2.MORPH_OPEN, kernel)

# 闭运算（先膨胀后腐蚀，填充小孔）
closing = cv2.morphologyEx(img, cv2.MORPH_CLOSE, kernel)
```

---

## 视频处理

### 1. 读取摄像头

```python
# 打开默认摄像头
cap = cv2.VideoCapture(0)

# 检查是否成功打开
if not cap.isOpened():
    print("无法打开摄像头")
    exit()

while True:
    # 逐帧读取
    ret, frame = cap.read()
    
    if not ret:
        break
    
    # 显示帧
    cv2.imshow('Camera', frame)
    
    # 按 'q' 退出
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# 释放资源
cap.release()
cv2.destroyAllWindows()
```

### 2. 读取视频文件

```python
# 打开视频文件
cap = cv2.VideoCapture('video.mp4')

while cap.isOpened():
    ret, frame = cap.read()
    
    if not ret:
        break
    
    cv2.imshow('Video', frame)
    
    if cv2.waitKey(25) & 0xFF == ord('q'):
        break

cap.release()
cv2.destroyAllWindows()
```

### 3. 保存视频

```python
cap = cv2.VideoCapture(0)

# 定义编解码器和创建 VideoWriter 对象
fourcc = cv2.VideoWriter_fourcc(*'XVID')
out = cv2.VideoWriter('output.avi', fourcc, 20.0, (640, 480))

while cap.isOpened():
    ret, frame = cap.read()
    
    if not ret:
        break
    
    # 写入帧
    out.write(frame)
    
    cv2.imshow('Recording', frame)
    
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

cap.release()
out.release()
cv2.destroyAllWindows()
```

---

## 图像特征检测

### 1. 角点检测

```python
# Harris 角点检测
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
gray = np.float32(gray)
dst = cv2.cornerHarris(gray, 2, 3, 0.04)

# 标记角点
img[dst > 0.01 * dst.max()] = [0, 0, 255]
```

### 2. SIFT 特征检测

```python
# 创建 SIFT 对象
sift = cv2.SIFT_create()

# 检测关键点和描述符
keypoints, descriptors = sift.detectAndCompute(gray, None)

# 绘制关键点
img_with_keypoints = cv2.drawKeypoints(img, keypoints, None)
```

### 3. 轮廓检测

```python
# 转换为灰度图并二值化
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
ret, thresh = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY)

# 查找轮廓
contours, hierarchy = cv2.findContours(thresh, 
                                       cv2.RETR_TREE, 
                                       cv2.CHAIN_APPROX_SIMPLE)

# 绘制轮廓
cv2.drawContours(img, contours, -1, (0, 255, 0), 2)

# 获取轮廓属性
for cnt in contours:
    # 面积
    area = cv2.contourArea(cnt)
    # 周长
    perimeter = cv2.arcLength(cnt, True)
    # 边界矩形
    x, y, w, h = cv2.boundingRect(cnt)
```

---

## 实战案例

### 案例1：人脸检测

```python
import cv2

# 加载预训练的人脸检测分类器
face_cascade = cv2.CascadeClassifier(
    cv2.data.haarcascades + 'haarcascade_frontalface_default.xml'
)

# 读取图像
img = cv2.imread('people.jpg')
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# 检测人脸
faces = face_cascade.detectMultiScale(gray, 1.3, 5)

# 绘制矩形框
for (x, y, w, h) in faces:
    cv2.rectangle(img, (x, y), (x+w, y+h), (255, 0, 0), 2)

cv2.imshow('Faces', img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

### 案例2：颜色追踪

```python
import cv2
import numpy as np

cap = cv2.VideoCapture(0)

while True:
    ret, frame = cap.read()
    
    # 转换到 HSV 空间
    hsv = cv2.cvtColor(frame, cv2.COLOR_BGR2HSV)
    
    # 定义蓝色的 HSV 范围
    lower_blue = np.array([110, 50, 50])
    upper_blue = np.array([130, 255, 255])
    
    # 创建掩码
    mask = cv2.inRange(hsv, lower_blue, upper_blue)
    
    # 应用掩码
    result = cv2.bitwise_and(frame, frame, mask=mask)
    
    cv2.imshow('Original', frame)
    cv2.imshow('Mask', mask)
    cv2.imshow('Result', result)
    
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

cap.release()
cv2.destroyAllWindows()
```

### 案例3：图像拼接

```python
import cv2
import numpy as np

# 读取两张图像
img1 = cv2.imread('image1.jpg')
img2 = cv2.imread('image2.jpg')

# 水平拼接
horizontal = np.hstack((img1, img2))

# 垂直拼接
vertical = np.vstack((img1, img2))

cv2.imshow('Horizontal', horizontal)
cv2.imshow('Vertical', vertical)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

---

## 常用技巧和注意事项

### 1. 颜色空间
- OpenCV 默认使用 BGR 格式，而不是常见的 RGB
- 显示时需要注意颜色顺序

### 2. 坐标系统
- 图像坐标系：原点在左上角
- 访问像素：`img[y, x]` 或 `img[row, col]`

### 3. 数据类型
- 读取的图像默认是 `uint8` 类型（0-255）
- 某些操作需要转换为浮点类型

### 4. 性能优化
- 尽量使用 NumPy 的向量化操作
- 避免使用 Python 循环处理像素
- 对于大图像，考虑缩小尺寸后再处理

### 5. 窗口管理
- 使用 `cv2.waitKey(0)` 保持窗口打开
- 使用 `cv2.destroyAllWindows()` 关闭所有窗口
- 在视频处理中使用 `cv2.waitKey(1)` 实现流畅播放

---

## 进阶学习资源

- **官方文档**: https://docs.opencv.org/
- **OpenCV Python 教程**: https://docs.opencv.org/master/d6/d00/tutorial_py_root.html
- **GitHub 示例**: 搜索 opencv-python examples

## 总结

这份入门指南涵盖了 OpenCV Python 的基础知识和常用操作。通过这些内容，你可以：
- 读取、显示和保存图像
- 进行基本的图像处理操作
- 处理视频流
- 检测图像特征
- 实现简单的计算机视觉应用

继续深入学习，你将能够构建更复杂的计算机视觉项目！