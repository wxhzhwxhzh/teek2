---
id: intro1
permalink: /requests/intro1
title: 'ğŸ”µ å…¥é—¨'
---

# Python Requests åº“å…¥é—¨æŒ‡å—

## ç®€ä»‹

Requests æ˜¯ Python ä¸­æœ€æµè¡Œçš„ HTTP åº“ä¹‹ä¸€ï¼Œå®ƒè®©å‘é€ HTTP è¯·æ±‚å˜å¾—ç®€å•è€Œä¼˜é›…ã€‚ç›¸æ¯” Python å†…ç½®çš„ `urllib`ï¼ŒRequests æä¾›äº†æ›´åŠ äººæ€§åŒ–çš„ APIã€‚

## å®‰è£…

ä½¿ç”¨ pip å®‰è£… requestsï¼š

```bash
pip install requests
```

## åŸºç¡€ä½¿ç”¨

### 1. å‘é€ GET è¯·æ±‚

GET è¯·æ±‚æ˜¯æœ€å¸¸è§çš„ HTTP è¯·æ±‚ç±»å‹ï¼Œç”¨äºä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚

```python
import requests

# å‘é€ç®€å•çš„ GET è¯·æ±‚
response = requests.get('https://api.github.com')

# æŸ¥çœ‹å“åº”çŠ¶æ€ç 
print(response.status_code)  # 200

# æŸ¥çœ‹å“åº”å†…å®¹
print(response.text)  # è¿”å›å­—ç¬¦ä¸²æ ¼å¼çš„å“åº”å†…å®¹
```

### 2. å¸¦å‚æ•°çš„ GET è¯·æ±‚

```python
# æ–¹å¼ä¸€ï¼šåœ¨ URL ä¸­ç›´æ¥æ‹¼æ¥å‚æ•°
response = requests.get('https://api.github.com/search/repositories?q=python')

# æ–¹å¼äºŒï¼šä½¿ç”¨ params å‚æ•°ï¼ˆæ¨èï¼‰
params = {
    'q': 'python',
    'sort': 'stars',
    'order': 'desc'
}
response = requests.get('https://api.github.com/search/repositories', params=params)
```

### 3. å‘é€ POST è¯·æ±‚

POST è¯·æ±‚é€šå¸¸ç”¨äºå‘æœåŠ¡å™¨æäº¤æ•°æ®ã€‚

```python
# å‘é€è¡¨å•æ•°æ®
data = {
    'username': 'user123',
    'password': 'pass123'
}
response = requests.post('https://httpbin.org/post', data=data)

# å‘é€ JSON æ•°æ®
json_data = {
    'name': 'John',
    'age': 30
}
response = requests.post('https://httpbin.org/post', json=json_data)
```

### 4. å…¶ä»– HTTP æ–¹æ³•

```python
# PUT è¯·æ±‚
response = requests.put('https://httpbin.org/put', data={'key': 'value'})

# DELETE è¯·æ±‚
response = requests.delete('https://httpbin.org/delete')

# PATCH è¯·æ±‚
response = requests.patch('https://httpbin.org/patch', data={'key': 'value'})

# HEAD è¯·æ±‚
response = requests.head('https://httpbin.org/get')
```

## å¤„ç†å“åº”

### 1. å“åº”å†…å®¹

```python
response = requests.get('https://api.github.com')

# è·å–æ–‡æœ¬å†…å®¹
print(response.text)

# è·å–äºŒè¿›åˆ¶å†…å®¹
print(response.content)

# è·å– JSON å†…å®¹
json_data = response.json()
print(json_data)

# è·å–å“åº”ç¼–ç 
print(response.encoding)
```

### 2. å“åº”çŠ¶æ€

```python
response = requests.get('https://api.github.com')

# çŠ¶æ€ç 
print(response.status_code)

# åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç  < 400ï¼‰
if response.ok:
    print("è¯·æ±‚æˆåŠŸ")

# å“åº”å¤´
print(response.headers)
print(response.headers['Content-Type'])

# è¯·æ±‚ URL
print(response.url)
```

### 3. å¼‚å¸¸å¤„ç†

```python
from requests.exceptions import RequestException, Timeout, HTTPError

try:
    response = requests.get('https://api.github.com', timeout=5)
    response.raise_for_status()  # å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼ŒæŠ›å‡º HTTPError
    print(response.json())
except Timeout:
    print("è¯·æ±‚è¶…æ—¶")
except HTTPError as e:
    print(f"HTTP é”™è¯¯: {e}")
except RequestException as e:
    print(f"è¯·æ±‚å¼‚å¸¸: {e}")
```

## é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰è¯·æ±‚å¤´

```python
headers = {
    'User-Agent': 'Mozilla/5.0',
    'Authorization': 'Bearer YOUR_TOKEN',
    'Content-Type': 'application/json'
}

response = requests.get('https://api.github.com', headers=headers)
```

### 2. Cookies å¤„ç†

```python
# å‘é€ cookies
cookies = {'session_id': '123456'}
response = requests.get('https://httpbin.org/cookies', cookies=cookies)

# è·å–å“åº”ä¸­çš„ cookies
response = requests.get('https://httpbin.org/cookies/set/my_cookie/123')
print(response.cookies['my_cookie'])
```

### 3. ä¼šè¯å¯¹è±¡ï¼ˆSessionï¼‰

ä½¿ç”¨ Session å¯ä»¥åœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿æŒæŸäº›å‚æ•°ï¼Œä¾‹å¦‚ cookiesã€‚

```python
# åˆ›å»ºä¼šè¯
session = requests.Session()

# è®¾ç½®ä¼šè¯çº§åˆ«çš„è¯·æ±‚å¤´
session.headers.update({'Authorization': 'Bearer TOKEN'})

# ç¬¬ä¸€ä¸ªè¯·æ±‚
response1 = session.get('https://httpbin.org/cookies/set/session/123')

# ç¬¬äºŒä¸ªè¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦ç¬¬ä¸€ä¸ªè¯·æ±‚è®¾ç½®çš„ cookie
response2 = session.get('https://httpbin.org/cookies')
print(response2.json())

# å…³é—­ä¼šè¯
session.close()
```

### 4. è¶…æ—¶è®¾ç½®

```python
# è®¾ç½® 5 ç§’è¶…æ—¶
response = requests.get('https://api.github.com', timeout=5)

# åˆ†åˆ«è®¾ç½®è¿æ¥è¶…æ—¶å’Œè¯»å–è¶…æ—¶
response = requests.get('https://api.github.com', timeout=(3, 10))
```

### 5. ä»£ç†è®¾ç½®

```python
proxies = {
    'http': 'http://10.10.1.10:3128',
    'https': 'http://10.10.1.10:1080',
}

response = requests.get('https://api.github.com', proxies=proxies)
```

### 6. æ–‡ä»¶ä¸Šä¼ 

```python
# ä¸Šä¼ å•ä¸ªæ–‡ä»¶
files = {'file': open('report.txt', 'rb')}
response = requests.post('https://httpbin.org/post', files=files)

# ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
files = {
    'file1': open('file1.txt', 'rb'),
    'file2': open('file2.txt', 'rb')
}
response = requests.post('https://httpbin.org/post', files=files)

# æŒ‡å®šæ–‡ä»¶åå’Œå†…å®¹ç±»å‹
files = {
    'file': ('report.csv', open('report.csv', 'rb'), 'text/csv')
}
response = requests.post('https://httpbin.org/post', files=files)
```

### 7. æµå¼ä¸‹è½½å¤§æ–‡ä»¶

```python
# ä¸‹è½½å¤§æ–‡ä»¶æ—¶ä½¿ç”¨æµå¼ä¼ è¾“
response = requests.get('https://example.com/large-file.zip', stream=True)

with open('large-file.zip', 'wb') as f:
    for chunk in response.iter_content(chunk_size=8192):
        if chunk:
            f.write(chunk)
```

## å®ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šè·å– GitHub ç”¨æˆ·ä¿¡æ¯

```python
import requests

username = 'torvalds'
url = f'https://api.github.com/users/{username}'

response = requests.get(url)

if response.status_code == 200:
    user_data = response.json()
    print(f"ç”¨æˆ·å: {user_data['login']}")
    print(f"å§“å: {user_data['name']}")
    print(f"å…¬å¼€ä»“åº“æ•°: {user_data['public_repos']}")
    print(f"ç²‰ä¸æ•°: {user_data['followers']}")
else:
    print(f"è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
```

### ç¤ºä¾‹ 2ï¼šå¸¦è®¤è¯çš„ API è¯·æ±‚

```python
import requests

# Basic è®¤è¯
response = requests.get(
    'https://api.github.com/user',
    auth=('username', 'password')
)

# Token è®¤è¯
headers = {'Authorization': 'token YOUR_GITHUB_TOKEN'}
response = requests.get('https://api.github.com/user', headers=headers)
```

### ç¤ºä¾‹ 3ï¼šä¸‹è½½å›¾ç‰‡

```python
import requests

url = 'https://example.com/image.jpg'
response = requests.get(url)

if response.status_code == 200:
    with open('image.jpg', 'wb') as f:
        f.write(response.content)
    print("å›¾ç‰‡ä¸‹è½½æˆåŠŸ")
```

## æœ€ä½³å®è·µ

1. **å§‹ç»ˆå¤„ç†å¼‚å¸¸**ï¼šç½‘ç»œè¯·æ±‚å¯èƒ½å¤±è´¥ï¼Œè¦åšå¥½å¼‚å¸¸å¤„ç†
2. **è®¾ç½®è¶…æ—¶**ï¼šé¿å…è¯·æ±‚æ— é™æœŸæŒ‚èµ·
3. **ä½¿ç”¨ Session**ï¼šå¯¹åŒä¸€ä¸»æœºçš„å¤šæ¬¡è¯·æ±‚ä½¿ç”¨ Session å¯ä»¥æé«˜æ€§èƒ½
4. **æ£€æŸ¥çŠ¶æ€ç **ï¼šä½¿ç”¨ `response.raise_for_status()` æˆ–æ£€æŸ¥ `response.ok`
5. **å¤§æ–‡ä»¶ä½¿ç”¨æµå¼ä¼ è¾“**ï¼šé¿å…å†…å­˜æº¢å‡º
6. **åˆç†ä½¿ç”¨ headers**ï¼šç‰¹åˆ«æ˜¯ User-Agentï¼Œé¿å…è¢«æœåŠ¡å™¨æ‹’ç»

## å¸¸è§é—®é¢˜

### SSL è¯ä¹¦éªŒè¯

```python
# å¿½ç•¥ SSL è¯ä¹¦éªŒè¯ï¼ˆä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰
response = requests.get('https://example.com', verify=False)

# æŒ‡å®šè¯ä¹¦è·¯å¾„
response = requests.get('https://example.com', verify='/path/to/cert.pem')
```

### é‡å®šå‘å¤„ç†

```python
# å…è®¸é‡å®šå‘ï¼ˆé»˜è®¤ï¼‰
response = requests.get('https://github.com', allow_redirects=True)

# ç¦æ­¢é‡å®šå‘
response = requests.get('https://github.com', allow_redirects=False)

# æŸ¥çœ‹é‡å®šå‘å†å²
print(response.history)
```

## æ€»ç»“

Requests åº“æä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„ API æ¥å¤„ç† HTTP è¯·æ±‚ã€‚æŒæ¡ä»¥ä¸Šå†…å®¹ï¼Œä½ å°±å¯ä»¥åº”å¯¹å¤§éƒ¨åˆ† Web è¯·æ±‚åœºæ™¯äº†ã€‚æ›´å¤šé«˜çº§åŠŸèƒ½å’Œè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://requests.readthedocs.io/)ã€‚